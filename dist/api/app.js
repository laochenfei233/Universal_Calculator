const express=require("express"),cors=require("cors"),path=require("path"),requestLogger=require("./middleware/requestLogger"),rateLimitMiddleware=require("./middleware/rateLimiter"),{errorHandler,notFoundHandler}=require("./middleware/errorHandler"),{sqlInjectionProtection,xssProtection,inputValidation,securityHeaders,corsConfig,enhancedRateLimit}=require("./middleware/security"),apiRoutes=require("./routes"),app=express();app.set("trust proxy",1),app.use(securityHeaders),app.use(corsConfig),app.use(express.json({limit:"10mb"})),app.use(express.urlencoded({extended:!0,limit:"10mb"})),"test"!==process.env.NODE_ENV&&app.use(requestLogger),app.use(sqlInjectionProtection),app.use(xssProtection),app.use(inputValidation),app.use("/api",enhancedRateLimit);const staticPath="production"===process.env.NODE_ENV?path.join(__dirname,"public"):path.join(__dirname,"../public");app.use(express.static(staticPath)),app.use("/api",apiRoutes),app.get("/",(e,r)=>{const i="production"===process.env.NODE_ENV?path.join(__dirname,"public","index.html"):path.join(__dirname,"../public","index.html");r.sendFile(i)}),app.use(notFoundHandler),app.use(errorHandler),module.exports=app;